{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\n\n\nconst formSearch = document.querySelector('.form');\nconst imageList = document.querySelector('.gallery');\nconst loader = document.querySelector('.loader');\nconst loadMoreBtn = document.querySelector('.load-more-btn');\n\nconst gallery = new SimpleLightbox('.gallery a', {\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nlet currentPage = 1;\n\nformSearch.addEventListener('submit', handleSearch);\nloadMoreBtn.addEventListener('click', handleLoadMore);\n\nlet endMessageExists = false;\n\nfunction handleSearch(event) {\n  event.preventDefault();\n  const searchQuery = event.currentTarget.elements.input.value;\n\n  imageList.innerHTML = '';\n    currentPage = 1;\n    hideEndMessage();\n\n    if (!searchQuery.trim()) {\n    showNotification({\n      title: '❕',\n      theme: 'light',\n      message: 'Please, fill in the search field',\n      messageSize: '20px',\n      messageColor: '#808080',\n      backgroundColor: '#e7fc44',\n      position: 'topLeft',\n      timeout: 3000,\n    });\n    return;\n  }\n\n  fetchAndRenderImages(searchQuery);\n}\n\nasync function fetchAndRenderImages(value) {\n    try {\n        const data = await fetchImages(value, currentPage);\n        \n        if (data.hits.length === 0) {\n            showNotification({\n                title: '❕',\n                theme: 'dark',\n                message: 'Sorry, there are no images matching your search query. Please try again!',\n                messageSize: '16px',\n                messageColor: 'white',\n                backgroundColor: '#EF4040',\n                position: 'topRight',\n                timeout: 5000,\n            });\n        } else {\n            imageList.innerHTML += createMarkup(data.hits);\n            gallery.refresh();\n            showLoadMoreBtn();\n            hideEndMessage();\n            smoothScrollToNextGroup();\n      \n      if (data.hits.length < data.totalHits) {\n        updateLoadMoreButtonState(data.totalHits, data.hits);\n      } else {\n        hideLoadMoreBtn();\n        showEndMessage();\n        endMessageExists = true;\n      }\n    }\n\n  } catch (error) {\n    handleError(error);\n  } finally {\n    loader.classList.add('is-hidden');\n  }\n}\n\nfunction updateLoadMoreButtonState(totalHits) {\n  const remainingHits = totalHits - currentPage * 15;\n\n  if (remainingHits <= 0) {\n      hideLoadMoreBtn();\n      if (!endMessageExists) {\n          showEndMessage(); \n          endMessageExists = true;\n      }\n  }\n}\n\nasync function fetchImages(value, page = 1, perPage = 15) {\n  const BASE_URL = 'https://pixabay.com/api/';\n  const API_KEY = '42027170-68cc294651d415255967a4fd3';\n\n  try {\n    const response = await axios.get(BASE_URL, {\n      params: {\n        key: API_KEY,\n        q: value,\n        image_type: 'photo',\n        orientation: 'horizontal',\n        safesearch: true,\n        page: page,\n        per_page: perPage,\n      },\n    });\n\n    if (response.status !== 200) {\n      throw new Error(response.status);\n    }\n\n    return response.data;\n  } catch (error) {\n    throw new Error(error);\n  }\n}\n\nfunction createMarkup(arr) {\n  return arr\n    .map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) =>\n      `<li class=\"gallery-item\">\n        <a class=\"gallery-link\" href=\"${largeImageURL}\">\n           <img class=\"gallery-image\" src=\"${webformatURL}\" alt=\"${tags}\" />\n        </a>\n        <div class=\"container-additional-info\">\n          <div class=\"container-descr-inner\"><p class=\"description\">Likes</p><span class=\"description-value\">${likes}</span></div>\n          <div class=\"container-descr-inner\"><p class=\"description\">Views</p><span class=\"description-value\">${views}</span></div>\n          <div class=\"container-descr-inner\"><p class=\"description\">Comments</p><span class=\"description-value\">${comments}</span></div>\n          <div class=\"container-descr-inner\"><p class=\"description\">Downloads</p><span class=\"description-value\">${downloads}</span></div>\n        </div>\n      </li>`\n    )\n    .join('');\n}\n\nfunction showNotification(options) {\n  iziToast.show(options);\n}\n\nfunction handleError(err) {\n    console.error(err);\n    imageList.innerHTML = '';\n    showNotification({\n        title: '❕',\n        theme: 'dark',\n        message: 'Sorry, there is a problem with the connection to the server.',\n        messageSize: '16px',\n        messageColor: 'white',\n        backgroundColor: '#EF4040',\n        position: 'center',\n        timeout: 5000,\n    });\n}\n\nfunction handleLoadMore() {\n  currentPage += 1;\n  const searchQuery = formSearch.elements.input.value;\n  loader.classList.remove('is-hidden');\n    hideLoadMoreBtn();\n    hideEndMessage();\n    fetchAndRenderImages(searchQuery);\n}\n\nfunction showLoadMoreBtn() {\n    loadMoreBtn.classList.remove('is-hidden');\n}\n\nfunction hideLoadMoreBtn() {\n  loadMoreBtn.classList.add('is-hidden');\n}\n\nfunction showEndMessage() {\n  const endMessage = document.createElement('div');\n  endMessage.classList.add('end-message');\n    endMessage.textContent = \"We're sorry, but you've reached the end of search results.\";\n    document.body.appendChild(endMessage);\n}\n\nfunction hideEndMessage() {\n  const endMessage = document.querySelector('.end-message');\n  \n  if (endMessage) {\n      endMessage.remove();\n  }\n}\n\nfunction smoothScrollToNextGroup() {\n  const cardHeight = document.querySelector('.gallery-item').getBoundingClientRect().height;\n  window.scrollBy({\n    top: cardHeight * 2,\n    behavior: 'smooth',\n  });\n}\n\n\n\n\n"],"names":["formSearch","imageList","loader","loadMoreBtn","gallery","SimpleLightbox","currentPage","handleSearch","handleLoadMore","endMessageExists","event","searchQuery","hideEndMessage","showNotification","fetchAndRenderImages","value","data","fetchImages","createMarkup","showLoadMoreBtn","smoothScrollToNextGroup","updateLoadMoreButtonState","hideLoadMoreBtn","showEndMessage","error","handleError","totalHits","page","perPage","BASE_URL","API_KEY","response","axios","arr","webformatURL","largeImageURL","tags","likes","views","comments","downloads","options","iziToast","err","endMessage","cardHeight"],"mappings":"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"}